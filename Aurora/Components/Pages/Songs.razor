// =================================================================================
// Songs.razor - SONGS MANAGEMENT PAGE UI COMPONENT
// =================================================================================
// This file contains the HTML UI and CSS styling for the Songs page.
// Inherits from SongsPage.cs for all backend logic.
// NO JavaScript - all styling in CSS, basic HTML5 audio controls.

@page "/songs"                      // URL route for this page
@inherits SongsPage                // Inherits backend logic from SongsPage.cs

// ===== CSS STYLING =====
// Modern glassmorphism design with gradients and animations
// Responsive layout that works on all screen sizes
<style>
    /* ===== CSS CUSTOM PROPERTIES (VARIABLES) ===== */
    /* Define color scheme for consistent theming across the page */
    :root {
        --primary-cyan: #00ffff;        /* Bright cyan for accents and highlights */
        --primary-blue: #0080ff;        /* Electric blue for primary elements */
        --primary-purple: #8000ff;       /* Purple for secondary highlights */
        --primary-pink: #ff0080;         /* Pink for special elements */
        --secondary-green: #00ff80;      /* Green for success states */
        --accent-orange: #ff8000;        /* Orange for ratings and stars */
        --dark-space: #0a0a0f;          /* Dark background for cards */
        --deep-space: #050509;          /* Very dark background for main page */
        --glass-bg: rgba(255, 255, 255, 0.05); /* Semi-transparent white for glass effect */
    }

    /* ===== MAIN PAGE LAYOUT ===== */
    .songs-container {
        min-height: 100vh;                                           /* Full viewport height */
        background: linear-gradient(135deg, var(--deep-space) 0%, var(--dark-space) 100%); /* Diagonal gradient background */
        color: white;                                                /* White text on dark background */
        padding: 2rem;                                              /* Space around content */
    }

    /* ===== HEADER SECTION ===== */
    .songs-header {
        display: flex;                                              /* Flexbox layout */
        justify-content: space-between;                             /* Title left, button right */
        align-items: center;                                        /* Vertical center alignment */
        margin-bottom: 2rem;                                       /* Space below header */
        padding: 1rem 0;                                          /* Vertical padding */
        border-bottom: 1px solid var(--glass-bg);                  /* Subtle separator line */
    }

    .songs-title {
        font-size: 2.5rem;                                         /* Large title text */
        font-weight: bold;                                         /* Bold weight */
        background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue)); /* Gradient text */
        -webkit-background-clip: text;                             /* Clip background to text */
        -webkit-text-fill-color: transparent;                      /* Make text transparent to show gradient */
        background-clip: text;                                     /* Standard background clip */
    }

    /* ===== UPLOAD BUTTON ===== */
    .upload-btn {
        background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue)); /* Gradient background */
        border: none;                                              /* Remove default border */
        padding: 0.75rem 1.5rem;                                  /* Button padding */
        border-radius: 25px;                                      /* Rounded corners */
        color: white;                                             /* White text */
        font-weight: bold;                                        /* Bold text */
        cursor: pointer;                                          /* Hand cursor on hover */
        transition: all 0.3s ease;                               /* Smooth transitions */
    }

    .upload-btn:hover {
        transform: translateY(-2px);                              /* Lift effect on hover */
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);           /* Glow effect */
    }

    /* ===== SONGS GRID LAYOUT ===== */
    .songs-grid {
        display: grid;                                             /* CSS Grid layout */
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); /* Responsive columns */
        gap: 1.5rem;                                              /* Space between cards */
        margin-bottom: 2rem;                                      /* Space below grid */
    }

    /* ===== SONG CARDS ===== */
    .song-card {
        background: var(--glass-bg);                              /* Semi-transparent background */
        backdrop-filter: blur(10px);                              /* Blur effect for glassmorphism */
        border-radius: 15px;                                      /* Rounded corners */
        padding: 1.5rem;                                         /* Card padding */
        border: 1px solid rgba(255, 255, 255, 0.1);              /* Subtle border */
        transition: all 0.3s ease;                               /* Smooth animations */
    }

    .song-card:hover {
        transform: translateY(-5px);                              /* Lift effect */
        box-shadow: 0 10px 30px rgba(0, 255, 255, 0.1);          /* Glow shadow */
    }

    /* ===== SONG INFORMATION ===== */
    .song-title {
        font-size: 1.2rem;                                       /* Title size */
        font-weight: bold;                                       /* Bold text */
        margin-bottom: 0.5rem;                                  /* Space below title */
        color: white;                                           /* White text */
    }

    .song-artist {
        color: var(--primary-cyan);                              /* Cyan color for artist */
        margin-bottom: 1rem;                                    /* Space below artist */
        font-size: 0.9rem;                                      /* Smaller text */
    }

    /* ===== RATING SYSTEM ===== */
    .song-rating {
        display: flex;                                           /* Flexbox layout */
        align-items: center;                                     /* Vertical center */
        gap: 0.5rem;                                            /* Space between elements */
        margin-bottom: 1rem;                                    /* Space below rating */
    }

    .stars {
        display: flex;                                          /* Flexbox for star alignment */
        gap: 2px;                                               /* Small gap between stars */
    }

    .star {
        color: #ddd;                                            /* Light gray for empty stars */
        cursor: pointer;                                        /* Hand cursor for clickability */
        font-size: 1.2rem;                                      /* Star size */
        transition: color 0.2s ease;                           /* Smooth color transitions */
    }

    .star.filled {
        color: var(--accent-orange);                            /* Orange for filled stars */
    }

    .star:hover {
        color: var(--accent-orange);                            /* Orange on hover */
    }

    .rating-text {
        color: #aaa;                                           /* Gray text for rating number */
        font-size: 0.9rem;                                     /* Smaller text */
    }

    /* ===== AUDIO CONTROLS ===== */
    .audio-controls {
        margin-top: 1rem;                                       /* Space above controls */
    }

    /* ===== PROGRESS BAR (TIMELINE) ===== */
    .progress-container {
        position: relative;                                     /* For absolute positioning of progress */
        width: 100%;                                           /* Full width */
        height: 6px;                                           /* Thin bar height */
        background: rgba(255, 255, 255, 0.2);                  /* Light background */
        border-radius: 3px;                                    /* Rounded corners */
        margin-bottom: 0.5rem;                                /* Space below bar */
        cursor: pointer;                                       /* Hand cursor for clicking */
    }

    .progress-bar {
        height: 100%;                                          /* Fill container height */
        background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue)); /* Gradient fill */
        border-radius: 3px;                                    /* Rounded corners */
        width: 0%;                                             /* Start empty, fills during playback */
        transition: width 0.1s ease;                          /* Smooth width changes */
    }

    /* ===== TIME DISPLAY ===== */
    .time-display {
        display: flex;                                         /* Flexbox layout */
        justify-content: space-between;                         /* Current time left, total time right */
        font-size: 0.8rem;                                     /* Small text */
        color: #aaa;                                           /* Gray text */
        margin-bottom: 0.5rem;                                /* Space below time */
    }

    /* ===== PLAY/PAUSE BUTTON ===== */
    .play-btn {
        background: var(--primary-cyan);                       /* Cyan background */
        border: none;                                          /* Remove border */
        width: 40px;                                           /* Fixed size */
        height: 40px;                                          /* Fixed size */
        border-radius: 50%;                                    /* Perfect circle */
        color: white;                                          /* White icon */
        font-size: 1.2rem;                                     /* Icon size */
        cursor: pointer;                                       /* Clickable */
        display: flex;                                         /* Center icon */
        align-items: center;                                   /* Vertical center */
        justify-content: center;                               /* Horizontal center */
        transition: all 0.3s ease;                           /* Smooth transitions */
    }

    .play-btn:hover {
        transform: scale(1.1);                                 /* Grow on hover */
        box-shadow: 0 0 20px rgba(0, 255, 255, 0.5);          /* Glow effect */
    }

    /* ===== UPLOAD MODAL ===== */
    .upload-modal {
        position: fixed;                                        /* Fixed position overlay */
        top: 0;                                                /* Top of screen */
        left: 0;                                               /* Left of screen */
        width: 100%;                                           /* Full width */
        height: 100%;                                          /* Full height */
        background: rgba(0, 0, 0, 0.8);                        /* Semi-transparent black overlay */
        display: flex;                                         /* Flexbox centering */
        align-items: center;                                   /* Vertical center */
        justify-content: center;                               /* Horizontal center */
        z-index: 1000;                                         /* High z-index for modal */
    }

    .upload-form {
        background: var(--dark-space);                         /* Dark background */
        padding: 2rem;                                         /* Form padding */
        border-radius: 15px;                                   /* Rounded corners */
        border: 1px solid var(--glass-bg);                     /* Glass border */
        width: 90%;                                            /* Responsive width */
        max-width: 500px;                                      /* Maximum width */
    }

    /* ===== FORM ELEMENTS ===== */
    .form-group {
        margin-bottom: 1.5rem;                                 /* Space between form fields */
    }

    .form-label {
        display: block;                                        /* Block element */
        margin-bottom: 0.5rem;                                /* Space below label */
        color: white;                                          /* White text */
        font-weight: bold;                                     /* Bold labels */
    }

    .form-input {
        width: 100%;                                           /* Full width */
        padding: 0.75rem;                                      /* Input padding */
        border: 1px solid rgba(255, 255, 255, 0.2);            /* Light border */
        border-radius: 8px;                                    /* Rounded corners */
        background: rgba(255, 255, 255, 0.05);                 /* Semi-transparent background */
        color: white;                                          /* White text */
        font-size: 1rem;                                       /* Standard text size */
    }

    .form-input:focus {
        outline: none;                                         /* Remove default outline */
        border-color: var(--primary-cyan);                     /* Cyan border on focus */
        box-shadow: 0 0 10px rgba(0, 255, 255, 0.3);          /* Glow effect */
    }

    /* ===== FORM BUTTONS ===== */
    .form-buttons {
        display: flex;                                         /* Flexbox layout */
        gap: 1rem;                                             /* Space between buttons */
        justify-content: flex-end;                             /* Right alignment */
    }

    .cancel-btn {
        background: rgba(255, 255, 255, 0.1);                  /* Semi-transparent background */
        border: 1px solid rgba(255, 255, 255, 0.2);            /* Light border */
        padding: 0.75rem 1.5rem;                              /* Button padding */
        border-radius: 8px;                                    /* Rounded corners */
        color: white;                                          /* White text */
        cursor: pointer;                                       /* Clickable */
    }

    .submit-btn {
        background: linear-gradient(45deg, var(--primary-cyan), var(--primary-blue)); /* Gradient background */
        border: none;                                          /* Remove border */
        padding: 0.75rem 1.5rem;                              /* Button padding */
        border-radius: 8px;                                    /* Rounded corners */
        color: white;                                          /* White text */
        font-weight: bold;                                     /* Bold text */
        cursor: pointer;                                       /* Clickable */
    }

    .submit-btn:hover {
        transform: translateY(-2px);                           /* Lift effect */
        box-shadow: 0 5px 15px rgba(0, 255, 255, 0.3);        /* Glow effect */
    }
</style>

<!-- ===== MAIN PAGE CONTAINER ===== -->
<div class="songs-container">
    <!-- ===== PAGE HEADER ===== -->
    <div class="songs-header">
        <h1 class="songs-title">My Songs</h1>                    <!-- Page title with gradient effect -->
        <button class="upload-btn" @onclick="ShowUploadForm">Upload Song</button> <!-- Opens upload modal -->
    </div>

    <!-- ===== SONGS GRID ===== -->
    <div class="songs-grid">
        @foreach (var song in userSongs)
        {
            <!-- ===== INDIVIDUAL SONG CARD ===== -->
            <div class="song-card">
                <!-- Song title -->
                <div class="song-title">@song.Title</div>

                <!-- Artist information (currently shows "Unknown Artist" for all) -->
                <div class="song-artist">
                    @if (songArtists.ContainsKey(song.SongId))
                    {
                        @string.Join(", ", songArtists[song.SongId])    <!-- Join multiple artists with commas -->
                    }
                    else
                    {
                        <span>Unknown Artist</span>                     <!-- Fallback for missing artist data -->
                    }
                </div>

                <!-- ===== RATING SYSTEM ===== -->
                <div class="song-rating">
                    <!-- Star rating display (1-5 clickable stars) -->
                    <div class="stars">
                        @for (int i = 1; i <= 5; i++)
                        {
                            <span class="star @(userRatings.ContainsKey(song.SongId) && userRatings[song.SongId] >= i ? "filled" : "")"
                                  @onclick="() => RateSongAsync(song.SongId, i)">  <!-- Click to rate song -->
                                ★                                                      <!-- Star symbol -->
                            </span>
                        }
                    </div>

                    <!-- Average rating display -->
                    <span class="rating-text">
                        @if (songRatings.ContainsKey(song.SongId) && songRatings[song.SongId] > 0)
                        {
                            @songRatings[song.SongId].ToString("0.0")    <!-- Show average rating -->
                        }
                        else
                        {
                            <span>No ratings</span>                     <!-- No ratings yet -->
                        }
                    </span>
                </div>

                <!-- ===== AUDIO CONTROLS ===== -->
                <div class="audio-controls">
                    <!-- Time display: current time | total duration -->
                    <div class="time-display">
                        <span>@(currentPlayingSong == song.FilePath ? currentTime : "0:00")</span>  <!-- Current playback time (MM:SS) -->
                        <span>@FormatDuration(song.Duration)</span>     <!-- Total song duration (MM:SS) -->
                    </div>

                    <!-- Progress bar / timeline (clickable for seeking) -->
                    <div class="progress-container" @onmousedown="e => SeekToPosition(e, song.Duration)">
                        <div class="progress-bar" style="width: @GetProgressPercentage()%;"></div> <!-- Fills during playback -->
                    </div>

                    <!-- Play/Pause button -->
                    <button class="play-btn" @onclick="@(() => PlayPauseSong(song.FilePath))">
                        @(isPlaying && currentPlayingSong == song.FilePath ? "⏸" : "▶") <!-- Pause or Play icon -->
                    </button>
                </div>
            </div>
        }
    </div>

    <!-- ===== UPLOAD MODAL (only shown when showUploadModal is true) ===== -->
    @if (showUploadModal)
    {
        <div class="upload-modal">
            <div class="upload-form">
                <h2 style="color: white; margin-bottom: 1.5rem;">Upload New Song</h2>

                <!-- Song title input -->
                <div class="form-group">
                    <label class="form-label">Song Title</label>
                    <input type="text" class="form-input" @bind="songTitle" placeholder="Enter song title" />
                </div>

                <!-- File upload input (accepts only audio files) -->
                <div class="form-group">
                    <label class="form-label">Audio File</label>
                    <InputFile class="form-input" OnChange="HandleFileSelection" accept="audio/*" />
                </div>

                <!-- Primary artist input -->
                <div class="form-group">
                    <label class="form-label">Primary Artist</label>
                    <input type="text" class="form-input" @bind="primaryArtist" placeholder="Main artist" />
                </div>

                <!-- Additional artists (comma-separated) -->
                <div class="form-group">
                    <label class="form-label">Additional Artists (optional)</label>
                    <input type="text" class="form-input" @bind="additionalArtists" placeholder="Additional artists, separated by commas" />
                </div>

                <!-- Genre selection dropdown -->
                <div class="form-group">
                    <label class="form-label">Genre</label>
                    <select class="form-input" @bind="selectedGenreId">
                        <option value="1">Pop</option>
                        <option value="2">Rock</option>
                        <option value="3">Hip Hop</option>
                        <option value="4">Electronic</option>
                        <option value="5">Jazz</option>
                    </select>
                </div>

                <!-- Form action buttons -->
                <div class="form-buttons">
                    <button class="cancel-btn" @onclick="HideUploadForm">Cancel</button>     <!-- Close modal -->
                    <button class="submit-btn" @onclick="HandleUpload">Upload</button>      <!-- Process upload -->
                </div>
            </div>
        </div>
    }
</div>

@code {
    // ===== @CODE SECTION =====
    // Contains C# methods that are used directly in the Razor markup
    // These methods are called from HTML onclick events

}
